<!DOCTYPE html>
<html lang="ko" xml:lang="ko">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="title">
  <meta name="copyright" content="Copyright ⓒ Aromatica Corp.All Rights Reserved.">
  <meta name="description" content="">
  <title>아로마티카</title>

  <!-- jquery cdn + load skin -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

  <!-- slick slide -->
  <link rel="stylesheet" type="text/css" href="../../js/ui/lib/slick.css"/>
  <script type="text/javascript" src="../../js/ui/lib/slick.min.js"></script>

  <!-- swiper -->
  <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script
    src="https://kit.fontawesome.com/82ebd05d63.js"
    crossorigin="anonymous"
  ></script>
  <!-- font -->
  <script src="https://kit.fontawesome.com/72ae761282.js" crossorigin="anonymous"></script>
  <!-- swiper -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"
  />


  <!-- style -->
  <link rel="stylesheet" type="text/css" href="../../css/style.css" />

</head>

<body>

    {% include("./default/header.njk") %}

    <main class="main-container">
      {% block content %} {% endblock %}
    </main>

    <!-- btn-section -->
    <section class="fixed-btn">
      <div class="top-btn" onclick="window.scrollTo(0,0);">
      <p>TOP</p>
      </div>
      <div class="my-wrap">
      <div id="user-btn">
      <i class="fa-solid fa-user"></i>
      </div>
      <div id="cart-btn">
          <p>3</p>
      <i class="fa-solid fa-cart-shopping"></i>
      </div>
      </div>
    </section>

    <!-- modal-section -->
        <!-- cart-modal -->
    <div id="modal" class="cart-wish-wrap-overlay" style="display:none">
      <div class="wrap-window">
        <section class="cart-wrap">
          <div class="inner">
            <div class="title-wrap">
              <div class="cancel-btn">
                <i class="fa-solid fa-xmark"></i>
              </div>
              <h4>CART</h4>
              <p>장바구니 내역을 확인해주세요.</p>
            </div>
            
            <!--product-wrap --!>
            <div class="product-wrap">
              <h5>Product</h5>
 <form action="/page" name="order-form" id="order-form" method="post"
class="order-form">
<input type="hidden" name="order-input" value="order">
    <div class="basket-wrap" id="basket-wrap">
      <!-- head -->
      <div class="row-wrap head">
        <div class="sub-wrap">
          <div class="check">선택</div>
          <div class="img">이미지</div>
          <div class="product-name">상품명</div>
        </div>
        <div class="sub-wrap">
          <div class="basket-price">가격</div>
          <div class="num">수량</div>
          <div class="sum">합계</div>
        </div>
        <div class="sub-wrap">
          <div class="basket-remove">삭제</div>
        </div>
        <div class="split"></div>
      </div>
      <!-- 상품 1 -->
      <div class="row-wrap data">
        <!-- sub-wrap -->
        <div class="sub-wrap">
          <div class="check">
            <input type="checkbox" name="buy" value="260" checked=""
            onclick="javascript:basket.checkItem();">&nbsp;
          </div>
          <div class="img">
            <img src="../../img/teatree/shampoo01.jpeg" width="60"></div>
            <div class="product-name">
              <span>티트리 퓨리파잉 샴푸 400ML</span>
            </div>
          </div>
          
        <!-- sub-wrap2 -->
          <div class="sub-wrap">
            <div class="basket-price">
              <input type="hidden" name="p_price" id="p_price1" class="p_price" value="16000">16,000원
              </div>
              <div class="num">
                <div class="updown">
                  <input type="text" name="p_num1" id="p_num1" size="2" maxlength="4" class="p_num" value="2" 
                  onkeyup="javascript:basket.changePNum(1);">
                  <span onclick="javascript:basket.changePNum(1);"><i class="fas fa-arrow-alt-circle-up up"></i></span>
                  <span onclick="javascript:basket.changePNum(1);"><i class="fas fa-arrow-alt-circle-down down"></i></span>
                </div>
              </div>
              <div class="sum">32,000원</div>
          </div>
        <!-- sub-wrap3 -->
          <div class="sub-wrap">
            <div class="basket-remove">
              <a href="javascript:void(0)" class="abutton" onclick="javascript:basket.delItem();">삭제</a>
            </div>
          </div>
        </div>
      <!-- 상품 2 -->
      <div class="row-wrap data">
        <!-- sub-wrap -->
        <div class="sub-wrap">
        <div class="check">
            <input type="checkbox" name="buy" value="261" checked=""
            onclick="javascript:basket.checkItem();">&nbsp;
          </div>
          <div class="img">
              <img src="../../img/teatree/shampoo07.jpeg" width="60"></div>
            <div class="product-name">
              <span>티트리 퓨리파잉 토닉 100ML</span>
            </div>
          </div>
          <!-- sub-wrap2 -->
          <div class="sub-wrap">
            <div class="basket-price">
              <input type="hidden" name="p_price" id="p_price2" class="p_price" value="10000">10,000원</div>
              <div class="num">
                <div class="updown">
                  <input type="text" name="p_num2" id="p_num2" size="2" maxlength="4" class="p_num" value="3" 
                  onkeyup="javascript:basket.changePNum(2);">
                  <span onclick="javascript:basket.changePNum(2);"><i class="fas fa-arrow-alt-circle-up up"></i></span>
                  <span onclick="javascript:basket.changePNum(2);"><i class="fas fa-arrow-alt-circle-down down"></i></span>
                </div>
              </div>
              <div class="sum">30,000원</div>
          </div>
          <!-- sub-wrap3 -->
          <div class="sub-wrap">
            <div class="basket-remove">
              <a href="javascript:void(0)" class="abutton" onclick="javascript:basket.delItem();">삭제</a>
            </div>
          </div>
        </div>
      <!-- 상품 3 -->
      <div class="row-wrap data">
        <!-- sub-wrap -->
        <div class="sub-wrap">
        <div class="check">
            <input type="checkbox" name="buy" value="262" checked=""
            onclick="javascript:basket.checkItem();">&nbsp;
          </div>
          <div class="img">
          <img src="../../img/teatree/shampoo10.jpeg" width="60"></div>
            <div class="product-name">
              <span>티트리 퓨리파잉 샴푸바 130G</span>
            </div>
          </div>
          <!-- sub-wrap2 -->
          <div class="sub-wrap">
            <div class="basket-price">
              <input type="hidden" name="p_price" id="p_price3" class="p_price" value="20000">20,000원</div>
              <div class="num">
                <div class="updown">
                  <input type="text" name="p_num3" id="p_num3" size="2" maxlength="4" class="p_num" value="2" 
                  onkeyup="javascript:basket.changePNum(3);">
                  <span onclick="javascript:basket.changePNum(3);"><i class="fas fa-arrow-alt-circle-up up"></i></span>
                  <span onclick="javascript:basket.changePNum(3);"><i class="fas fa-arrow-alt-circle-down down"></i></span>
                </div>
              </div>
              <div class="sum">40,000원</div>
          </div>
          <!-- sub-wrap3 -->
          <div class="sub-wrap">
            <div class="basket-remove">
                <a href="javascript:void(0)" class="abutton" onclick="javascript:basket.delItem();">삭제</a>
            </div>
          </div>
        </div>
    </div>
    <!-- 삭제 비우기 버튼 -->
    <div class="right-align basket-row-remove">
      <a href="javascript:void(0)" class="a-button"
      onclick="javascript:basket.delCheckedItem();" >선택상품삭제</a>
      <a href="javascript:void(0)" class="a-button"
      onclick="javascript:basket.delAllItem();">장바구니비우기</a>
    </div>
    <!-- 텍스트 -->
    <div class="bigtext-wrap right-align sumcount"id="sum_p_num">
      상품갯수: 7개
    </div>
    <div class="bigtext-wrap right-align box blue summoney"id="sum_p_price">
      합계금액: 102,000원
    </div>

    <!-- 주문버튼 -->
    <div id="go-order">
      <div class="clear"></div>
      <div class="button-group center-align cmd">
        <a href="javascript:void(0);">선택한 상품 주문</a>
      </div>
    </div>
</form>

            </div>
          </div>
        </section>
      </div>
    </div>

          <!-- log-in-modal -->
      <div id="logIn-modal" class="log-in-wrap"
      style="display:none">
        <div class="inner">
          <section class="log-in-title">
            <h3>SIGN IN</h3>
            <p class="close">x</p>
          </section>
          <section class="id-pw-wrap">
            <input type="text" placeholder="아이디" />
            <input type="password" placeholder="비밀번호" />
            <p class="find">아이디 찾기 * 비밀번호 찾기</p>
          </section>
          <section class="btn-wrap">
            <button id= "submit">로그인</button>
            <div class="find-way-wrap">
              <p>아이디가 없으신가요?</p>
              <p><a href="#">회원가입</a></p>
            </div>
          </section>
        </div>
      </div>
    {% include("./default/footer.njk") %}



  <script>
  //선언
  const modal = document.getElementById("modal");
  const userModal = document.getElementById("logIn-modal");

  //함수
  function modalOn() {
    modal.style.display = "flex"
  }
  function modalOpen() {
    userModal.style.display = "flex"
  }
  function modalOff() {
    modal.style.display = "none"
  }
  function modalClose() {
    userModal.style.display = "none"
  }



  const btnModal = document.getElementById("cart-btn")
  btnModal.addEventListener("click", e => {
    modalOn()
})
  const userModalBtn = document.getElementById("user-btn")
  userModalBtn.addEventListener("click", e => {
    modalOpen()
})

const closeBtn = modal.querySelector(".cancel-btn");
const closeUserBtn = userModal.querySelector(".close");


closeBtn.addEventListener("click", e => {
    modalOff()
})
closeUserBtn.addEventListener("click", e => {
    modalClose()
})

modal.addEventListener("click", e => {
    const evTarget = e.target
    if(evTarget.classList.contains("cart-wish-wrap-overlay")) {
        modalOff()
    }
})

userModal.addEventListener("click", e => {
    const evTargets = e.target
    if(evTargets.classList.contains("log-in-wrap")) {
        modalOff()
    }
})


<!-- cart --!>
let basket = {
  totalCount: 0, 
  totalPrice: 0,
  //체크한 장바구니 상품 비우기
  delCheckedItem: function(){
      document.querySelectorAll("input[name=buy]:checked").forEach(function (item) {
          item.parentElement.parentElement.parentElement.remove();
      });
      //AJAX 서버 업데이트 전송
  
      //전송 처리 결과가 성공이면
      this.reCalc();
      this.updateUI();
  },
  //장바구니 전체 비우기
  delAllItem: function(){
      document.querySelectorAll('.row-wrap.data').forEach(function (item) {
          item.remove();
        });
        //AJAX 서버 업데이트 전송
      
        //전송 처리 결과가 성공이면
        this.totalCount = 0;
        this.totalPrice = 0;
        this.reCalc();
        this.updateUI();
  },
  //재계산
  reCalc: function(){
      this.totalCount = 0;
      this.totalPrice = 0;
      document.querySelectorAll(".p_num").forEach(function (item) {
          if(item.parentElement.parentElement.parentElement.previousElementSibling.firstElementChild.firstElementChild.checked == true){
              var count = parseInt(item.getAttribute('value'));
              this.totalCount += count;
              var price = item.parentElement.parentElement.previousElementSibling.firstElementChild.getAttribute('value');
              this.totalPrice += count * price;
          }
      }, this); // forEach 2번째 파라메터로 객체를 넘겨서 this 가 객체리터럴을 가리키도록 함. - thisArg
  },
  //화면 업데이트
  updateUI: function () {
      document.querySelector('#sum_p_num').textContent = '상품갯수: ' + this.totalCount.formatNumber() + '개';
      document.querySelector('#sum_p_price').textContent = '합계금액: ' + this.totalPrice.formatNumber() + '원';
  },
  //개별 수량 변경
  changePNum: function (pos) {
      var item = document.querySelector('input[name=p_num'+pos+']');
      var p_num = parseInt(item.getAttribute('value'));
      var newval = event.target.classList.contains('up') ? p_num+1 : event.target.classList.contains('down') ? p_num-1 : event.target.value;
      
      if (parseInt(newval) < 1 || parseInt(newval) > 99) { return false; }

      item.setAttribute('value', newval);
      item.value = newval;

      var price = item.parentElement.parentElement.previousElementSibling.firstElementChild.getAttribute('value');
      item.parentElement.parentElement.nextElementSibling.textContent = (newval * price).formatNumber()+"원";
      //AJAX 업데이트 전송

      //전송 처리 결과가 성공이면    
      this.reCalc();
      this.updateUI();
  },
  checkItem: function () {
      this.reCalc();
      this.updateUI();
  },
  delItem: function () {
      event.target.parentElement.parentElement.parentElement.remove();
      this.reCalc();
      this.updateUI();
  }
}

// 숫자 3자리 콤마찍기
Number.prototype.formatNumber = function(){
  if(this==0) return 0;
  let regex = /(^[+-]?\d+)(\d{3})/;
  let nstr = (this + '');
  while (regex.test(nstr)) nstr = nstr.replace(regex, '$1' + ',' + '$2');
  return nstr;
};
</script>
</body>

</html>
